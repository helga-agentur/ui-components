!function(){"use strict";var t=(t,e,{transform:n=(t=>t),validate:a=(()=>!0),expectation:r="(expectation not provided)"}={})=>{const i=t.getAttribute(e),o=n(i);if(!a(o))throw new Error(`Expected attribute ${e} of element ${t.outerHTML} to be ${r}; got ${o} instead (${i} before the transform function was applied).`);return o};class e{#t;#e;constructor(t,e){this.#t=t,this.#e=this.#n(e)}#n(t){const e=this.#t.querySelector(t);if(!e)throw new Error(`Could not find container to place content within; no child element matches selector ${t}.`);return e}#a(t){return t.reduce(((t,e)=>t||this.#t.querySelector(e)),null)}#r(t,e){return Array.from(Object.entries(e)).reduce(((t,[e,n])=>t.replaceAll(`{{${e}}}`,n)),t)}generateContent(t,e=null,n=!1){const a=this.#a(t);if(!a){if(n)throw new Error(`Could not find child element that matches any selector ${t}.`);return}const r=a.innerHTML;this.setContent(e?this.#r(r,e):r)}setContent(t){this.#e.innerHTML=t}}class n extends HTMLElement{#i={initial:"initial",loading:"loading",failed:"failed",loaded:"loaded"};#o;#s=this.#i.initial;#l;constructor(){super(),this.endpointURL=t(this,"data-endpoint-url");const n=t(this,"data-trigger-event-name"),a=t(this,"data-trigger-event-names",{transform:t=>t?t.split(/\s*,\s*/):[],validate:t=>t.length>0||n,expectation:"a comma-separated list of event names"});if(this.triggerEventNames=[n,...a],this.eventEndpointPropertyName=t(this,"data-event-endpoint-property-name"),this.triggerEventFilter=t(this,"data-trigger-event-filter"),this.loadOnce=t(this,"data-load-once",{transform:t=>""===t}),!this.endpointURL&&!this.eventEndpointPropertyName)throw new Error('The attributes "data-endpoint-url" or "data-event-endpoint-property-name" were not found but one of them needs to be set.');this.#l=new e(this,"[data-content-container]")}connectedCallback(){this.#d()}disconnectedCallback(){this.#o.forEach((t=>t()))}#d(){this.#o=this.triggerEventNames.map((t=>((t,e,n)=>(t.addEventListener(e,n),()=>t.removeEventListener(e,n)))(window,t,this.#h.bind(this))))}#h(t){if(this.triggerEventFilter)try{const e=Function("event",`return ${this.triggerEventFilter}`);if(!e(t))return}catch(t){throw t.message=`The filter function provided through the trigger-event-filter attribute of <async-loader> threw the following error: ${t.message}`,t}const e=this.endpointURL||t.detail?.[this.eventEndpointPropertyName];if(!e)throw new Error(`The property ${this.eventEndpointPropertyName} either has no value or was not found in the payload of the "${t.type}" Event`);const n=[this.#i.loading,this.#i.loaded].includes(this.#s);this.loadOnce&&n||this.#c(e)}async#c(t){this.#s=this.#i.loading,this.#l.generateContent(["[data-loading-template]"]);try{const e=await fetch(t);if(e.ok){const t=await e.text();this.#s=this.#i.loaded,this.#l.setContent(t),this.#g(e)}else this.#p(`Status ${e.status}`,e,e.status)}catch(e){this.#p(e.message,t)}}#p(t,e,n=null){this.#s=this.#i.failed,this.#g(e,!0);const a=[...n?[`[data-error-${n}-template]`]:[],"[data-error-template]"];this.#l.generateContent(a,{message:t},!0)}#g(t,e=!1){const n=e?"asyncLoaderFail":"asyncLoaderSuccess",a={bubbles:!0,detail:{url:t.url,response:t,element:this}};this.dispatchEvent(new CustomEvent(n,a))}}window.customElements.get("async-loader")||window.customElements.define("async-loader",n)}();
