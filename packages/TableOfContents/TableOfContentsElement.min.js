!function(){"use strict";var e=e=>{if(!e.every((e=>e.name)))throw new Error(`canReadAttribute: Every config entry must be an object with property name; you passed ${JSON.stringify(e)} instead.`);return{readAttributes(){e.forEach((e=>{const{name:t,validate:n,property:o,transform:r}=e,s=this.getAttribute(t);if("function"==typeof n&&!n(s))throw new Error(`canWatchAttribute: Attribute ${t} does not match validation rules`);const a=r||(e=>e);this[o||t]=a(s)}))}}};class t extends HTMLElement{chapters=[];constructor(){super(),Object.assign(this,e([{name:"data-chapters-selector",property:"chaptersSelector",validate:e=>!!e},{name:"data-template-selector",validate:e=>!!e,property:"templateSelector"},{name:"data-template-content-selector",property:"templateContentSelector",validate:e=>!!e},{name:"data-template-link-selector",property:"templateLinkSelector"},{name:"data-offset-selector",property:"offsetSelector"},{name:"data-update-event-name",property:"updateEventName"},{name:"data-offset-value",property:"offsetValue",validate:e=>!e||!Number.isNaN(parseInt(e,10)),transform:e=>parseInt(e,10)}])),this.readAttributes()}connectedCallback(){this.getChapters(),this.updateDOM(),this.setupUpdateEventListener()}setupUpdateEventListener(){this.updateEventName&&window.addEventListener(this.updateEventName,(()=>{this.getChapters(),this.updateDOM()}))}getScrollOffset(){if(this.offsetValue)return this.offsetValue;if(!this.offsetSelector)return 0;const e=document.querySelector(this.offsetSelector);return e?e.getBoundingClientRect().height:(console.warn(`TableOfContents: Element to read offsetHeight from with selector ${this.offsetSelector} could not be found in DOM. Using 0 as default offset.`),0)}getChapters(){this.chapters=[];const e=document.querySelectorAll(this.chaptersSelector);e.length||console.warn("No titles found for selector %s",this.chaptersSelector);for(const t of e){const e=t.textContent;this.chapters.push({title:e,element:t})}}handleTitleClick(e){e.preventDefault();const t=e.currentTarget,n=t.element;if(!n)return void console.warn("Original element to scroll to not found for %o",t);const o=n.getBoundingClientRect().top;window.scrollBy({top:o-this.getScrollOffset(),behavior:"smooth"})}getTemplate(){const e=this.querySelector(this.templateSelector);if(!e)throw new Error(`TableOfContents: Template element with selector ${this.templateSelector} not found in ${this.outerHTML}`);return e}addAnchorLink(e,t){if(!this.templateLinkSelector)return;const n=t.matches(this.templateLinkSelector)&&t||t.querySelector(this.templateLinkSelector);if(!n)return void console.warn("TableOfContents: data-template-link-selector was set and is %s, but corresponding HTML element could not be found in template",this.templateLinkSelector);const o=e.getAttribute("id")||e.textContent.replace(/[^a-zA-Z0-9]+/g,"-").replace(/(^-|-$)/g,"").toLowerCase();n.setAttribute("href",`#${o}`),e.setAttribute("id",o)}updateDOM(){const e=this.getTemplate(),t=document.createDocumentFragment();this.chapters.forEach((n=>{const o=e.content.firstElementChild.cloneNode(!0),r=o.matches(this.templateContentSelector)&&o||o.querySelector(this.templateContentSelector);if(!r)throw new Error(`TableOfContents: Element to append title to not found; selector is ${this.templateContentSelector}, template ${o.outerHTML}`);r.textContent=n.title,o.element=n.element,o.addEventListener("click",this.handleTitleClick.bind(this)),this.addAnchorLink(n.element,o),t.appendChild(o)}));const n=[...e.parentNode.children].filter((e=>!e.matches(this.templateSelector)));for(const t of n)e.parentNode.removeChild(t);e.parentNode.appendChild(t)}}window.customElements.get("table-of-contents-component")||window.customElements.define("table-of-contents-component",t)}();
