!function(){"use strict";var t=()=>({eventHandlers:new Map,on(t,e){this.eventHandlers.has(t)?this.eventHandlers.get(t).push(e):this.eventHandlers.set(t,[e])},off(t,e){this.eventHandlers.has(t)&&(e?this.eventHandlers.set(t,this.eventHandlers.get(t).filter((t=>t!==e))):this.eventHandlers.delete(t))},emit(t,...e){(this.eventHandlers.get(t)||[]).forEach((t=>t(...e)))}});class e{loadingState=null;playing=!1;constructor(){Object.assign(this,t())}setURL(t){this.url=t}load(){this.loadingState="loading",this.emit("load"),this.audio=new Audio(this.url),this.audio.load(),this.setupAudioListeners()}getDuration(){return this.audio&&this.audio.duration}getVolume(){return this.audio&&this.audio.volume}getCurrentTime(){return this.audio&&this.audio.currentTime}setupAudioListeners(){this.audio.addEventListener("play",(()=>{this.emit("play"),this.playing=!0})),this.audio.addEventListener("timeupdate",(t=>{this.emit("timeupdate",t.timeStamp)})),this.audio.addEventListener("pause",(()=>{this.emit("pause"),this.playing=!1})),this.audio.addEventListener("volumechange",(t=>{this.emit("volumechange",this.getVolume())})),this.audio.addEventListener("canplaythrough",(async()=>{this.emit("canplaythrough"),this.loadingState="loaded",this.playing&&this.play()})),this.audio.addEventListener("error",console.error)}play(){this.playing=!0,"loaded"===this.loadingState&&this.audio.play()}pause(){this.playing=!1,"loaded"===this.loadingState&&this.audio.pause()}setVolume(t){this.audio.volume=t}setCurrentTime(t){this.audio.currentTime=t}}class i extends HTMLElement{constructor(){super(),this.audioModel=new e,Object.assign(this,(({eventName:t="announce-element",eventTarget:e=window,eventType:i,eventIdentifier:a,model:n}={})=>({registerAnnouncements(){e.addEventListener(t,(t=>{const{detail:e}=t;if(i&&e.eventType!==i)return;if(a&&e.eventIdentifier!==a)return;const{element:s}=t.detail;"function"!=typeof s.setModel?console.warn(`canRegisterElement: setModel is not a function on announcing element, but ${s.setModel}.`):s.setModel(n)}))}}))({eventTarget:this,model:this.audioModel})),this.audioModel.setURL(this.getAudioURL()),this.setupModelListeners()}setupModelListeners(){this.audioModel.on("canplaythrough",this.updateDOM.bind(this)),this.audioModel.on("play",this.updateDOM.bind(this)),this.audioModel.on("load",this.updateDOM.bind(this)),this.audioModel.on("pause",this.updateDOM.bind(this))}connectedCallback(){this.registerAnnouncements(),this.updateDOM()}getAudioURL(){return(({element:t,name:e,validate:i=(()=>!0),isSet:a=!1,errorMessage:n="HTML attribute not valid"}={})=>{if(!e)throw new Error(`getAndValidateAttribute: Pass an argument { name }; you passed ${e} instead.`);if(!(t&&t instanceof HTMLElement))throw new Error(`getAndValidateAttribute: Pass an argument { element } that is a HTMLElement; you passed ${t} instead.`);if(a){const a=t.hasAttribute(e);if(!0!==i(a))throw new Error(`getAndValidateAttribute: Attribute ${e} did not pass validation, is ${a}: ${n}.`);return a}const s=t.getAttribute(e);if(!0!==i(s))throw new Error(`getAndValidateAttribute: Attribute ${e} did not pass validation, is ${s}: ${n}.`);return s})({element:this,name:"data-source",validate:t=>t&&"string"==typeof t})}calculateState(){return"loading"===this.audioModel.loadingState?"loading":this.audioModel.playing?"playing":"loaded"===this.audioModel.loadingState?"paused":"initialized"}updateDOM(){requestAnimationFrame((()=>{this.dataset.state=this.calculateState()}))}}window.customElements.get("audio-component")||window.customElements.define("audio-component",i)}();
